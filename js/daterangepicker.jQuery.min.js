(function(e){var t,n,r;e.extend(e.fn,{dateRangePicker:function(i,s){var o=function(i,s){function h(e){if(e==null||!e.getDate())return"";var t=e.getDate(),n=e.getMonth(),r=e.getFullYear();return n++,e}function p(){if(r.data("state")=="closed")return m(),r.fadeIn(300).data("state","open"),t.onOpen(),A.hide(),g.show(),r.find(".title-start").text(t.rangeStartTitle),r.find(".title-end").text(t.rangeEndTitle),r.find(".range-start").restoreDateFromData().datepicker("refresh").css("opacity",1).show(400),r.find(".range-end").restoreDateFromData().datepicker("refresh").css("opacity",1).show(400),setTimeout(function(){A.fadeIn()},400),e().chosen!==undefined&&e().chosen.bind(),!1}function d(e){r.data("state")=="open"&&(r.fadeOut(300).data("state","closed"),_.isUndefined(e)&&t.onClose())}function v(){r.data("state")=="open"?d():p()}function m(){var e=i.offset(),t=e.left-5,n=e.top+i.outerHeight()+2;r.parent().css({left:t,top:n})}t=jQuery.extend({rangeStartTitle:"Start date",rangeEndTitle:"End date",nextLinkText:"Next",prevLinkText:"Prev",doneButtonText:"Done",constrainDates:!0,rangeSplitter:"-",dateFormat:"m/d/yy",closeOnSelect:!1,appendTo:"body",onClose:function(e,t){},onOpen:function(){},onChange:function(e,t){},defaultStartDate:Date.today(),defaultEndDate:Date.today(),minDate:Date.today().add({years:-10}),maxDate:Date.today(),tzOffset:0,datepickerOptions:null},s),n={onSelect:function(e,n){t.onUpdate(),t.closeOnSelect&&!r.find("li.ui-state-active").is(".ui-daterangepicker-dateRange")&&!r.is(":animated")&&d(),t.onChange()},defaultDate:0},t.onSelect=n.onSelect,t.onUpdate=function(){e(this).trigger("constrainOtherPicker");var n=new Date(r.find(".range-start").datepicker("getDate")),s=a(r.find(".time-start"));n.set({hour:s.hour,minute:s.minute,second:0});var o=new Date(r.find(".range-end").datepicker("getDate")),u=a(r.find(".time-end"));o.set({hour:u.hour,minute:u.minute,second:0});if(n.compareTo(o)>0){L.show(),A.trigger("disable");return}L.hide(),A.trigger("enable");var f=h(n),l=h(o);r.find(".ui-daterangepicker-specificDate").is(".ui-state-active")&&(l=f);var c=f.toString(t.dateFormat).replace(/AM/,"am").replace(/PM/,"pm").replace(" 0:"," 12:"),p=l.toString(t.dateFormat).replace(/AM/,"am").replace(/PM/,"pm").replace(" 0:"," 12:");i.val(c+" "+t.rangeSplitter+" "+p),t.startDate=n,t.endDate=o},i.bind("change",t.onChange),i.addClass("ui-rangepicker-input ui-widget-content"),i.wrap('<div class="ui-daterangepicker-arrows ui-widget ui-widget-header ui-helper-clearfix ui-corner-all"></div>'),i.attr("readonly",!0),t.datepickerOptions=s?jQuery.extend(n,s.datepickerOptions):n;var o=t.defaultStartDate,f=t.defaultEndDate,l,c;i.size()==2?(l=Date.parse(i.eq(0).val()),c=Date.parse(i.eq(1).val()),l==null&&(l=c),c==null&&(c=l)):(l=Date.parse(i.val().split(t.rangeSplitter)[0]),c=Date.parse(i.val().split(t.rangeSplitter)[1]),c==null&&(c=l)),l!=null&&(o=l),c!=null&&(f=c),r=e('<div class="ui-daterangepicker ui-widget ui-helper-clearfix ui-widget-content ui-corner-all"></div>'),jQuery.fn.restoreDateFromData=function(){return e(this).data("saveDate")&&e(this).datepicker("setDate",e(this).data("saveDate")).removeData("saveDate"),this},jQuery.fn.saveDateToData=function(){return e(this).data("saveDate")||e(this).data("saveDate",e(this).datepicker("getDate")),this};var g=e('<div class="ranges ui-widget-header ui-corner-all ui-helper-clearfix"><div class="range-start"><span class="title-start">Start Date</span></div><div class="range-end"><span class="title-end">End Date</span></div></div>').appendTo(r);g.find(".range-start, .range-end").datepicker(t.datepickerOptions),g.find(".range-start").datepicker("setDate",o),g.find(".range-end").datepicker("setDate",f),g.find(".range-start, .range-end").bind("constrainOtherPicker",function(){t.constrainDates&&(e(this).is(".range-start")?r.find(".range-end").datepicker("option","minDate",e(this).datepicker("getDate")):r.find(".range-start").datepicker("option","maxDate",e(this).datepicker("getDate")))}).trigger("constrainOtherPicker");var y="";for(var b=0;b<24;b++)for(var w=0;w<2;w++){var E="";b==0?E=12:b>12?E=b-12:E=b;var S="";w%2?S=":30":S=":00";var x="";b<12?x=" am":x=" pm";var T=E+S+x,N=b+S;y+='<option value="'+N+'">'+T+"</option>"}var C=[{parent:".range-start",className:"time-start",title:"Start Time",selectName:"timeStart"},{parent:".range-end",className:"time-end",title:"End Time",selectName:"timeEnd"}];for(var w in C){var k=C[w];g.find(k.parent).append('<div class="ui-timepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all '+k.className+'">'+'<span class="title">'+k.title+"</span>"+'<select name="'+k.selectName+'" class="input-dropdown">'+y+"</select>"+"</div>")}u(g.find(".time-start"),t.defaultStartDate),u(g.find(".time-end"),t.defaultEndDate),g.find(".time-start, .time-end").on("change",n.onSelect),r.find(".range-start").datepicker("option","minDate",t.minDate),r.find(".range-start").datepicker("option","maxDate",t.maxDate),r.find(".range-end").datepicker("option","minDate",t.minDate),r.find(".range-end").datepicker("option","maxDate",t.maxDate);var L=e('<div style="clear: both"></div><div class="error ui-state-error ui-corner-all ui-helper-clearfix" style="display: none"><p><span class="ui-icon ui-icon-alert"></span><strong>Error:</strong>End date cannot be earlier than the start date</p></div>').appendTo(g),A=e('<div class="input-block-level"><button class="btn btn-small btn-success pull-right"><i class="icon-ok"></i>'+t.doneButtonText+"</button></div>").click(function(){r.find(".ui-datepicker-current-day").trigger("click"),d()}).hover(function(){e(this).addClass("ui-state-hover")},function(){e(this).removeClass("ui-state-hover")}).bind("disable",function(){e(this).attr("disabled",!0),e(this).addClass("disabled")}).bind("enable",function(){e(this).removeAttr("disabled"),e(this).removeClass("disabled")}).appendTo(g);i.click(function(){return v(),!1}),g.hide().find(".range-start, .range-end, .btnDone").hide(),r.data("state","closed"),g.find(".ui-datepicker").css("display","block"),e(t.appendTo).append(r),r.wrap('<div class="ui-daterangepickercontain"></div>'),e(document).click(function(){r.is(":visible")&&d(!0)}),r.click(function(){return!1}).hide(),t.onUpdate()},u=function(t,n){var r=n.getMinutes();r>30?n.set({minute:30}):r>0&&r<30&&n.set({minute:0});var i=n.toString("H:mm");e(t).find("select").val(i)},a=function(t){var n=e(t).find("select").val(),r=parseInt(n.replace(/:.+$/,""),10),i=parseInt(n.replace(/^.+:/,""),10);return{hour:r,minute:i}};switch(i){case"getStartDate":return t.startDate;case"setStartDate":e(r).find(".range-start").datepicker("setDate",s),u(e(r).find(".time-start"),s),t.onSelect();break;case"getEndDate":return t.endDate;case"setEndDate":e(r).find(".range-end").datepicker("setDate",s),u(e(r).find(".time-end"),s),t.onSelect();break;default:o(this,i)}return e(this)}})})(jQuery);